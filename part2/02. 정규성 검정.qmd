# 정규성 검정

## 정규성 검정

많은 통계 기법은 다음을 가정한다.

* 표본이 정규분포를 따른다
* 또는 표본 평균이 정규분포를 따른다

적용 대상

* t 검정
* ANOVA
* 선형회귀 (잔차)

정규성 검정(Normality Test)은 **“데이터가 정규인가?”** 가 아니라 **“정규 가정을 써도 되는가?”** 를 판단하는 과정

## 정규성을 검사 필요 여부

| 상황           | 정규성 필요 여부 |
| ------------ | --------- |
| 원 데이터        | 경우에 따라    |
| 표본 평균        | CLT로 완화   |
| 소표본 (n < 30) | 매우 중요     |
| 잔차(residual) | 중요        |

## 시각적 정규성 검정

### (1) 히스토그램 + KDE

```{python}
import seaborn as sns
import matplotlib.pyplot as plt

df = sns.load_dataset("penguins").dropna()
```

```{python}
sns.histplot(
    df["body_mass_g"],
    kde=True
)
plt.show()
```

정규성 판단을 위한 점검 사항

* 종 모양 여부
* 대칭성
* 꼬리 방향

### (2) Q–Q Plot

```{python}
import scipy.stats as stats

stats.probplot(df["body_mass_g"], plot=plt)
plt.show()
```

해석

* 점들이 직선에 가까울수록 정규성 만족
* 양끝 이탈 → 꼬리 문제

## 통계적 정규성 검정

### 대표적인 정규성 검정 방법

| 검정                 | 특징       | 권장 상황    |
| ------------------ | -------- | -------- |
| Shapiro–Wilk       | 가장 보편적   | n ≤ 5000 |
| Kolmogorov–Smirnov | 기준 분포 필요 | 이론 검증    |
| Anderson–Darling   | 꼬리 민감    | 분포 비교    |
| D’Agostino         | 왜도·첨도    | 중대형 표본   |


### (1) Shapiro–Wilk 검정

```{python}
from scipy.stats import shapiro

stat, p_value = shapiro(df["body_mass_g"])

stat, p_value
```

판단

* p ≥ 0.05 → 정규성 가정 가능
* p < 0.05 → 정규성 위반

### (2) Anderson–Darling 검정

```{python}
from scipy.stats import anderson

result = anderson(df["body_mass_g"], dist="norm")
result
```

해석

* statistic < critical value → 정규성 만족
* 유의수준별 임계값 제공

##  표본 크기와 p-value의 함정

> **표본 수가 크면 거의 항상 p < 0.05**

```{python}
large_sample = df["body_mass_g"].sample(300, random_state=42)
shapiro(large_sample)
```

의미

* 통계적으로는 비정규
* 실무적으로는 문제 없음

**시각적 판단 + 목적 기반 판단이 중요**


## 정규성이 깨졌을 때의 대응 전략

### 분포 변환

* 로그 변환
* 제곱근 변환
* Box–Cox
* Yeo–Johnson

```{python}
import numpy as np

log_mass = np.log(df["body_mass_g"])
shapiro(log_mass)
```

### 비모수 검정 사용

| 상황    | 대안             |
| ----- | -------------- |
| 평균 비교 | Mann–Whitney   |
| 다집단   | Kruskal–Wallis |
| 상관    | Spearman       |

### 표본 평균 활용 (CLT)

* 충분한 표본 크기
* 독립성 만족

## 정규성 검정 유의사항

* 정규성 ≠ 절대 조건
* p-value 하나로 결정 ❌
* 시각 + 표본 크기 + 분석 목적 종합 판단

